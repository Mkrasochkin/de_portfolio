# Добавление нового источника в DWH

## Описание проекта

В связи с приобретением нового маркетплейса товаров ручной работы, возникла задача объединить данные купленного ресурса с текущим хранилищем. Основная цель — повышение эффективности маркетинга и внедрение программы лояльности путём изучения покупательских предпочтений.
На основе объединенных данных требовалось построить инкрементальную витрину для анализа поведения заказчиков, запуска программы лояльности и оптимизации маркетинговых акций.

### Что было сделано

*   **Интеграция нового источника**: Разработан **ETL-скрипт** для консолидации данных из 4-х разнородных схем (включая новую `external_source`) в единый **Staging-слой** через `UNION ALL`.
*   **Проектирование хранилища**: Реализована логика загрузки данных в измерения (**Dimensions**) и таблицы фактов (**Fact Tables**) с применением метода **Upsert (MERGE)** для обеспечения целостности данных.
*   **Разработка витрины**: Спроектирована **инкрементальная витрина** `dwh.customer_report_datamart`, выполняющая расчет более 15 бизнес-метрик (LTV, средний чек, медианное время доставки, популярные категории товаров и др.).


### Схема потока данных

```text
 [ Sources ]              [ Staging ]             [ Core DWH ]           [ Data Mart ]
 (1, 2, 3, Ext)  ───►  (tmp_sources)  ───►  (Dimensions & Facts)  ───►  (Reports)
```


## Навыки и инструменты

### SQL & Базы данных (PostgreSQL)
*   **Объединение данных**: Консолидация информации из разнородных источников через `UNION ALL` и многоуровневые `JOIN`.
*   **Синхронизация (Upsert)**: Использование оператора `MERGE` для обновления атрибутов и вставки новых записей в справочники.
*   **Сложные запросы**: Работа с временными таблицами (`TEMP TABLE`) и обобщенными табличными выражениями (`CTE`).

### Проектирование DWH
*   **Архитектура «Звезда»**: Проектирование и наполнение таблиц фактов (`f_order`) и измерений (`d_customer`, `d_product`, `d_craftsman`).


### ETL и автоматизация
*   **Инкрементальная загрузка (Delta Load)**: Настройка расчета только новых данных за отчетный период на основе меток времени (`load_dttm`).

### Бизнес-аналитика
*   **Расчет метрик**: Вычисление сложных агрегатов (медианное время выполнения заказа, доход платформы 10%, сегментация по статусам).
*   **Работа с датами**: Использование функций AGE, EXTRACT, TO_CHAR для работы с отчетными периодами.



## Общий вывод

В результате выполнения проекта была решена задача консолидации данных после слияния двух площадок. Реализованный подход позволяет системе масштабироваться: при добавлении новых источников структура DWH остается стабильной, а витрины данных обновляются инкрементально, что экономит вычислительные ресурсы сервера.